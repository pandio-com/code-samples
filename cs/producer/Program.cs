namespace Producing
{
    using DotPulsar;
    using DotPulsar.Abstractions;
    using DotPulsar.Extensions;
    using System;
    using System.Threading;
    using System.Collections.Generic;
    using System.Threading.Tasks;

    internal static class Program
    {
        private static async Task Main()
        {
            const string myTopic = "persistent://public/default/mytopic";

            var cts = new CancellationTokenSource();

            Console.CancelKeyPress += (sender, args) =>
            {
                cts.Cancel();
                args.Cancel = true;
            };

            await using var client = PulsarClient.Builder()
                .ServiceUrl(new Uri("pulsar+ssl://<pulsar-url>:6651"))
                .AuthenticateUsingToken("jwt-token")
                .Build(); //Connecting to pulsar://localhost:6650

            await using var producer = client.NewProducer(Schema.String)
                .StateChangedHandler(Monitor)
                .Topic(myTopic)
                .Create();

            Console.WriteLine("Press Ctrl+C to exit");

            ProduceMessages(producer, cts.Token);
        }

        private static void ProduceMessages(IProducer<string> producer, CancellationToken cancellationToken)
        {
            try
            {
                var start = DateTime.UtcNow.ToLongTimeString();
                var data = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam non elit ut ante elementum aliquam ac ac leo. Cras diam mauris, luctus et semper id, lobortis a libero. Nulla eget dictum nisl. Sed feugiat elit justo, sed rutrum ipsum congue quis. Ut sit amet libero dapibus, imperdiet libero et, rhoncus nulla. Cras nec fringilla odio, et porta odio. Duis efficitur leo et rhoncus lacinia.Nulla vitae viverra orci, eget bibendum ex. Vestibulum neque mi, sodales non euismod ac, lacinia sit amet lorem. Suspendisse varius neque turpis, non iaculis leo cursus sed. Sed bibendum et tortor a laoreet. Cras congue mattis eros in sagittis. Etiam quis sodales augue. Phasellus mattis ligula felis, eget imperdiet mi venenatis ac. Sed orci risus, egestas ut urna sit amet, vehicula consequat est. Sed vitae consectetur mauris, in varius justo. Duis sed accumsan lacus, quis suscipit sapien. Proin commodo, ipsum non gravida convallis, ligula neque tristique orci, ut ornare felis urna a sem. Sed vel pulvinar nunc. Mauris congue vehicula diam vel consequat. Pellentesque tempus iaculis justo, a fringilla mi lobortis non. Nunc ut condimentum tellus. Cras dictum velit dignissim posuere varius.Mauris volutpat a libero id faucibus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Proin molestie feugiat ornare. In ullamcorper velit non sagittis vehicula. Curabitur efficitur vel arcu in tincidunt. Curabitur sed elementum odio, ut laoreet ipsum. Nulla non libero malesuada, ultricies est scelerisque, euismod elit. Nam a vehicula quam, eget convallis nisl. Etiam turpis augue, feugiat quis nibh in, laoreet pulvinar justo. Pellentesque lacinia ligula at sodales sodales. Nullam in lorem nec purus eleifend posuere. Praesent fringilla gravida nunc.Morbi placerat porta metus, a interdum justo finibus eget. Aliquam erat volutpat. Nulla eget ligula magna. Aliquam massa ex, tempus non dignissim aliquet, vehicula ac quam. Vivamus sed vulputate nibh. Suspendisse potenti. Quisque dictum odio augue. In vehicula justo ut cursus pharetra. Donec vitae metus lacinia, varius augue id, aliquet lectus. In scelerisque mauris quis tellus euismod scelerisque. Integer condimentum massa vel justo bibendum iaculis. Suspendisse accumsan ligula nec finibus gravida.Fusce rutrum ullamcorper mi quis semper. Sed erat dui, malesuada ut dui porta, venenatis lobortis dui. Sed odio augue, venenatis ac sapien in, pulvinar egestas ipsum. Praesent nulla ipsum, gravida ac varius a, efficitur nec lectus. Phasellus sollicitudin posuere eros laoreet tristique. Proin nec hendrerit ante, nec volutpat magna. Sed at interdum risus. Proin ullamcorper dapibus leo convallis pharetra.Aliquam sollicitudin, nulla sit amet interdum rhoncus, risus massa hendrerit tortor, vitae efficitur ipsum massa et felis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Ut posuere neque nec risus volutpat blandit. Etiam in nibh volutpat risus cursus sagittis. Phasellus molestie mi vel libero laoreet, a tristique eros accumsan. Nunc eu nisl a nisi hendrerit bibendum vel a tellus. Aliquam nec est vulputate orci maximus condimentum nec sed nulla. Vestibulum lacinia purus eget lacus porttitor, finibus posuere arcu feugiat. Nam euismod id nunc et egestas. Nunc pulvinar urna ligula. Donec id dui tincidunt, posuere quam interdum, aliquam urna. Sed at mauris nec massa aliquam dictum id ac lorem.Quisque imperdiet dui ac purus ullamcorper finibus. Phasellus erat velit, ultrices at varius eu, interdum id quam. Duis id est in ipsum sodales sagittis eget eu nunc. Nunc in iaculis lacus. Morbi eget nulla ut arcu malesuada interdum. Vestibulum accumsan ut arcu eget pretium. Duis id sagittis metus. Etiam fermentum, felis eget laoreet sodales, mauris lectus tristique ligula, eget condimentum justo mi at mauris. Donec eget nisi sem. Donec et tempus libero, sit amet faucibus enim. Vivamus tincidunt nec eros quis mollis. Aliquam vitae consequat nunc, a lacinia enim. Vivamus non lacus egestas, aliquam massa eget, consectetur augue.Sed sit amet leo quis odio ornare hendrerit. Interdum et malesuada fames ac ante ipsum primis in faucibus. Sed suscipit sit amet arcu vitae feugiat. Aenean dui nunc, ultrices sit amet sagittis vel, bibendum quis ex. Phasellus volutpat volutpat quam et ornare. Morbi vitae justo ac nisl ultricies vulputate. Mauris commodo est ut tortor lacinia, sed rhoncus ligula aliquam. Aliquam velit orci, efficitur nec aliquet in, ullamcorper non risus. Fusce pretium et elit in finibus. Morbi mollis aliquam porttitor. Suspendisse diam velit, pretium sit amet consequat sed, placerat id massa. Ut gravida tortor ac vestibulum scelerisque. Aliquam et velit vitae augue mollis ornare id eget nibh. Morbi eleifend justo vel posuere pretium. Etiam tristique feugiat turpis, at egestas ex convallis non. Nullam eleifend dolor felis, eget suscipit dui tincidunt non.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer non bibendum tortor, quis volutpat tellus. Vivamus fringilla eu magna vitae ullamcorper. Mauris sagittis dictum blandit. Vestibulum fringilla risus sed diam interdum, ac elementum tellus blandit. Fusce varius vitae tortor nec feugiat. Donec in tortor lectus. Nullam rhoncus in dui et luctus.Duis ut elit id leo consequat sollicitudin. Maecenas nec sapien id tellus blandit ultrices ac nec dui. Suspendisse dolor ante, egestas sed dolor in, tristique efficitur neque. Proin rhoncus facilisis odio, eget finibus leo suscipit sit amet. Vivamus quis odio a diam molestie faucibus. Morbi purus velit, blandit eu elementum eget, tincidunt ac dui. Etiam luctus, tellus vitae ultrices iaculis, leo massa laoreet purus, id sollicitudin ante est ac massa. Phasellus bibendum sit amet enim id pharetra. Integer congue ac ipsum accumsan tempus. Aenean ex purus, volutpat ac magna sed, consequat rutrum mi. Donec vestibulum consequat diam, condimentum blandit enim aliquam a. In arcu augue, bibendum et interdum eget, condimentum vitae ligula. Maecenas sollicitudin diam sit amet dolor mattis, sed accumsan lacus euismod. Mauris pellentesque vel neque id fermentum. Nulla nisl tellus, consequat sed feugiat vel, pretium sit amet ligula. Nunc id imperdiet diam, sed ultrices odio.Aenean pretium pulvinar porttitor. Donec massa velit, laoreet sit amet eros varius, feugiat gravida ante. Sed vel sem vel ante consequat rhoncus. Pellentesque a nibh quis nulla volutpat vestibulum. In tempus, nisl eu cursus blandit, mi urna cursus lectus, in tristique lacus tellus vel libero. Donec varius posuere libero vitae rutrum. Vivamus non commodo mi.Cras pretium posuere dui eget porttitor. Nulla sed nulla tempus, feugiat sapien eget, elementum ex. Proin eu mauris blandit, pulvinar dui ut, pulvinar quam. Mauris nec justo vel ex consequat placerat. Nunc consequat eget elit finibus congue. Nam magna velit, tempor sit amet porttitor ut, tempus vel eros. Vestibulum ultricies dui ipsum, eget pellentesque nisi consequat nec. Maecenas ligula lectus, volutpat ac mauris eget, mattis venenatis metus. Donec scelerisque aliquam tellus, ornare cursus diam vehicula et. Cras eu fermentum lectus. Duis maximus dolor fringilla tristique mollis. Nam at elementum justo.Nulla commodo diam tellus, a dictum mauris egestas sed. Aliquam erat volutpat. Sed eu elementum lectus, nec hendrerit diam. Vivamus dignissim est sed ornare maximus. Ut sit amet nibh vel odio porttitor sollicitudin. Quisque viverra risus vel diam fermentum, ac malesuada ex posuere. Sed porttitor, tellus quis posuere sagittis, dui nisl egestas ipsum, facilisis suscipit nibh sapien consectetur velit.Vivamus vitae odio in mi pulvinar dictum. Mauris vestibulum faucibus massa, id iaculis lorem rhoncus id. Nullam urna justo, egestas id finibus ac, posuere dapibus eros. Donec efficitur non quam id gravida. Vivamus quis libero sed tellus hendrerit egestas vulputate sed neque. Sed turpis eros, sollicitudin eget faucibus sed, porta sit amet risus. Pellentesque molestie dui ac felis venenatis tempor. Aenean tincidunt rhoncus ipsum tincidunt malesuada.Aenean tincidunt ante felis, sed iaculis sem ultrices et. Nam pulvinar dolor sit amet sollicitudin viverra. Duis posuere velit ac bibendum imperdiet. Nam sodales neque ut mollis auctor. Pellentesque eget dapibus nibh. Nam ultricies dui erat. Nulla sit amet mollis quam. Suspendisse pulvinar fermentum lectus, ac egestas mauris. Curabitur eget nisi nunc. Phasellus convallis viverra lectus, in scelerisque nibh tincidunt et.Donec a lacinia leo. Vivamus porta ipsum purus, quis sagittis risus vestibulum vitae. Suspendisse semper ex mi, at mollis felis tincidunt eu. Praesent ac sodales augue. Sed a ipsum justo. Suspendisse nec nunc congue, ullamcorper lectus in, suscipit diam. In rhoncus pretium tristique. Aliquam erat volutpat.Quisque neque erat, sollicitudin nec condimentum vel, gravida sed felis. Phasellus dolor purus, pretium sit amet suscipit eget, faucibus sed neque. Curabitur nec nunc nec nibh iaculis sagittis a ut nunc. Quisque non vehicula dui. Etiam vel sapien sem. Morbi egestas erat eget pulvinar consequat. Nunc in ex a augue laoreet cursus vel sit amet mauris. Etiam eros nisi, tempus at lectus sit amet, efficitur lobortis sapien. Morbi felis eros, consequat ut vehicula at, lobortis nec ante. Nam a porttitor ligula, vitae rutrum nunc. Duis diam orci, vehicula et accumsan in, fermentum tincidunt nibh.Suspendisse ac nulla nec velit porta fermentum sed sed ex. Etiam in nulla sit amet orci ornare convallis. Sed non pulvinar nunc. Vivamus et metus bibendum, ullamcorper nisl vitae, egestas erat. Phasellus rhoncus, justo et rhoncus molestie, erat nulla tincidunt nulla, vitae maximus felis orci a risus. Nunc felis dolor, lobortis non semper vitae, facilisis eu nisl. Ut aliquet nec magna eget egestas. Donec dignissim mi at malesuada viverra. Maecenas tincidunt augue et augue rhoncus cursus. Donec vel enim dolor. Phasellus eu purus viverra, pretium massa et, gravida ex. Duis eu fringilla dui.Mauris id lacus et diam pharetra venenatis. Praesent eu mauris efficitur, imperdiet mi eget, ornare justo. Fusce eget tempus sem. Nam sed enim accumsan, rutrum elit ac, placerat lorem. Mauris justo mauris, eleifend vel sollicitudin at, pharetra vitae tortor. Duis a felis at tellus imperdiet molestie. Praesent ut ligula varius, blandit odio vel, porta dui. Aliquam tempor felis ut ligula ullamcorper, sed vestibulum nisi vestibulum. Mauris porta sed felis id iaculis. Vivamus suscipit neque nec dolor gravida, vitae tempor sem vestibulum.Phasellus nec neque semper, gravida odio et, rhoncus diam. Donec ultrices dapibus tincidunt. Proin sed lorem ullamcorper est pretium viverra nec quis lectus. Suspendisse potenti. Duis nec diam accumsan, rutrum nisi iaculis, venenatis metus. Donec ullamcorper egestas purus, scelerisque dapibus turpis. Sed eu mi vel nisl pellentesque sagittis vitae pretium ligula. Duis consequat scelerisque nulla, in facilisis ligula lobortis in.Sed tincidunt, quam lobortis tincidunt scelerisque, nibh dui facilisis neque, nec faucibus quam erat vel nunc. Vivamus faucibus eleifend urna, et pharetra augue imperdiet et. Nullam non imperdiet eros. Etiam porttitor est ac posuere accumsan. Donec eu eros id massa volutpat ornare. Fusce scelerisque, sapien nec bibendum bibendum, arcu tellus venenatis massa, non imperdiet lacus lacus sit amet lacus. Curabitur mattis non libero at auctor. Etiam sed sollicitudin metus. Integer porttitor maximus accumsan.Fusce blandit mauris suscipit tellus consequat tempor. Sed suscipit varius gravida. Curabitur porta finibus ligula et maximus. Sed sit amet ligula ac elit facilisis placerat. In porttitor felis condimentum eleifend malesuada. Nullam eu nibh vel turpis tempus commodo id sed dolor. Nam sollicitudin scelerisque eros, eu congue tortor suscipit a. Duis augue est, malesuada ac tincidunt at, sodales id urna. Fusce mattis tortor mi, sed imperdiet massa tempor sed. Quisque odio ligula, bibendum a sem a, dictum aliquam leo. In molestie pretium purus, vitae accumsan ipsum tempor sed.Duis accumsan feugiat felis, eget interdum metus vulputate eu. Vivamus molestie elit purus, sed commodo libero finibus quis. Sed faucibus lorem et ligula imperdiet, ac sodales nunc tincidunt. Integer quam neque, posuere at consequat quis, aliquam nec nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. In ullamcorper nisl vel mollis pharetra. Aliquam nec nisl in sem fringilla placerat. Nunc rhoncus tortor non diam tincidunt aliquet. Fusce egestas, nunc in hendrerit pretium, elit augue varius justo, ut pharetra ipsum risus ac dolor. Donec a elit at nulla mollis malesuada sit amet eu augue. Aenean placerat aliquet ligula laoreet porta.Ut id dapibus lorem, ac placerat orci. Mauris tristique hendrerit aliquam. Praesent massa tortor, auctor in aliquet nec, porta convallis lorem. Interdum et malesuada fames ac ante ipsum primis in faucibus. Donec ut rhoncus orci, in mattis lacus. Maecenas sed risus non turpis varius pharetra. Donec fermentum neque id cursus scelerisque. Sed non neque lectus. Interdum et malesuada fames ac ante ipsum primis in faucibus.Cras consequat, enim nec sollicitudin rhoncus, ipsum leo posuere augue, eu semper erat nisl vitae massa. In congue eget libero quis tristique. Donec a urna id felis consequat consequat vitae commodo enim. Ut sed iaculis nisi. Donec sagittis tincidunt massa in blandit. Phasellus ut lacinia velit, eu consequat ante. In bibendum ex a nisl sollicitudin semper. Sed ut viverra ligula, vel laoreet purus. Proin quis felis leo. Vivamus sagittis mattis tortor, id hendrerit lacus rutrum eget. Nulla facilisis eros vel magna volutpat viverra.Aliquam fermentum, nibh nec pretium dictum, diam risus accumsan orci, sed faucibus ante nulla non dolor. Nullam facilisis nibh sit amet semper feugiat. Morbi non massa leo. Ut magna turpis, sodales sed vehicula ac, tincidunt et sem. Aenean pharetra libero orci, a dictum dolor ultricies sit amet. Sed leo quam, porttitor et fermentum ut, suscipit sit amet nunc. Duis efficitur ultricies augue in tincidunt. Vestibulum tempor varius ultrices. Donec dictum vel enim ac semper. Quisque tortor elit, porta sed fringilla sed, interdum in nisl. Vivamus quis blandit mauris, at viverra velit.Quisque at sem sed nulla tempor dictum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Maecenas tincidunt mi a lacus pretium finibus. Aenean id hendrerit mi. Sed porta, nisi a imperdiet lobortis, nisi ante vehicula sapien, eget tempus neque mauris at dolor. Nulla pretium bibendum mollis. Pellentesque efficitur quis nulla sed tristique. Sed congue dapibus nisl, ac pretium nibh consectetur et. Maecenas euismod massa in rutrum sollicitudin. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Integer porttitor erat eget lacus tempor, sed egestas tellus lobortis. Nunc vitae urna eget massa auctor scelerisque in eget odio.Duis accumsan nisi odio, vitae sagittis ipsum tristique id. Morbi scelerisque libero nunc, vitae convallis risus accumsan id. Maecenas sit amet nisi consequat, venenatis elit in, pharetra libero. Suspendisse vitae ex sit amet arcu venenatis molestie. Nulla justo ligula, cursus vitae varius ac, commodo eget massa. Etiam augue nulla, ullamcorper ut mollis eget, interdum vitae turpis. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Pellentesque at vehicula lacus. Suspendisse pharetra urna sed arcu viverra, sed blandit turpis tincidunt. Morbi vel efficitur velit. Sed vitae purus mattis, laoreet nunc in, ullamcorper magna. Mauris malesuada, dui auctor tincidunt tincidunt, quam odio interdum quam, sed sollicitudin mauris tortor fringilla orci.Nunc ultrices eros vel tristique elementum. Nulla id justo est. Aliquam ex est, gravida quis nisl ac, sagittis semper odio. Nam sit amet lobortis elit, nec vestibulum urna. In pharetra id lacus vel sagittis. Aliquam posuere urna purus, et maximus sem mollis id. Nunc augue neque, vestibulum sed aliquam viverra, mollis eu magna. Phasellus vehicula gravida massa iaculis ultricies. Pellentesque vitae posuere libero. Aenean vehicula rutrum massa et sodales.Mauris sit amet erat id nisi dictum pharetra. Fusce nunc velit, luctus vel volutpat vitae, aliquet ut nibh. Morbi consectetur odio quis vestibulum pellentesque. Suspendisse potenti. Suspendisse potenti. In ut lacinia dolor. Nulla nec venenatis mi, sed vestibulum felis. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam erat volutpat. Pellentesque et erat ut magna aliquet euismod cursus eget felis. Curabitur elit nisi, vehicula at metus eu, dignissim malesuada enim. Donec sollicitudin diam id lectus efficitur tincidunt. Aliquam mattis elementum ligula, lacinia ullamcorper metus hendrerit vitae. Fusce dictum augue eu est tristique, ut cursus lectus fermentum. Nullam eget lacus imperdiet eros faucibus aliquet.Nullam viverra vitae eros volutpat vestibulum. Etiam eget felis mattis, euismod eros nec, blandit neque. Nulla facilisi. Cras et efficitur ligula. Praesent ut placerat dolor, et maximus eros. Sed tristique feugiat leo ac euismod. Nullam sit amet mi mi. Ut imperdiet, libero vitae maximus commodo, ante eros venenatis metus, eget egestas ipsum odio et augue. Nam efficitur consectetur bibendum.Vestibulum nibh nibh, porta sit amet congue in, rutrum vitae erat. Proin scelerisque sapien viverra dolor venenatis, sit amet luctus tellus tincidunt. Praesent et massa nulla. Sed eu faucibus nunc, nec hendrerit nibh. Nunc volutpat sapien vitae turpis pharetra, interdum pharetra purus pulvinar. Aliquam sit amet nisl eros. In a velit luctus, dapibus neque in, mattis justo. Ut ante neque, rutrum non arcu ac, aliquet auctor odio. Integer nec nisi gravida, tincidunt tortor sit amet, tristique dolor.Pellentesque vitae leo at urna ullamcorper imperdiet id eu arcu. Maecenas finibus pulvinar pellentesque. Morbi in mattis leo, quis auctor nunc. Quisque nec facilisis tortor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur feugiat eros nec ipsum finibus, eu rutrum ante consectetur. Vivamus in lectus lobortis, egestas magna blandit, pulvinar nulla. Morbi eu condimentum turpis. Integer ac pulvinar nisi, sit amet gravida massa. Donec eget diam vulputate, hendrerit odio fringilla, cursus mauris. Curabitur aliquet nisl vitae tellus tincidunt malesuada. Nam ante purus, semper ac lacus sit amet, venenatis viverra augue. Etiam dictum, quam congue bibendum congue, augue metus iaculis nunc, porttitor sagittis felis enim et urna.Donec mauris magna, consectetur sed molestie non, imperdiet et risus. Praesent pellentesque neque nibh, ut lacinia lectus feugiat ultricies. Fusce vehicula suscipit scelerisque. Morbi fringilla lectus lectus, sed condimentum lectus ultricies non. Sed pharetra ligula et nibh elementum volutpat. Integer lacinia mattis accumsan. Suspendisse sodales dui ipsum, ut pretium ante vestibulum vitae. Ut ligula metus, eleifend id orci viverra, pharetra efficitur quam. Maecenas malesuada felis quis leo molestie, in dapibus eros tincidunt.Suspendisse tincidunt elementum egestas. Duis porttitor rhoncus velit vitae rhoncus. Cras dictum blandit arcu. Cras tincidunt, diam sed viverra lacinia, justo augue semper metus, sit amet venenatis felis lectus vitae lacus. Fusce tincidunt a tortor eget posuere. Morbi ut dolor non odio vehicula porta eu vel ex. Duis ligula nisi, hendrerit vitae sollicitudin nec, blandit nec magna. Maecenas quis luctus erat.Proin posuere nisi a vehicula aliquam. Sed non nibh posuere, dignissim risus tincidunt, sagittis neque. Duis quis ex fringilla, fringilla lectus vitae, molestie leo. Integer accumsan volutpat nisi. Fusce dolor felis, vulputate at efficitur sed, euismod sit amet risus. Phasellus at fermentum nisi, ac dignissim eros. Cras efficitur nulla ligula, sed facilisis leo accumsan sed. Aliquam egestas, ligula in aliquet sodales, urna ipsum ultrices nulla, id consectetur est sem et enim. Nam id arcu non tortor tristique euismod.Duis consectetur ultricies purus, non dictum elit pellentesque id. Sed dignissim mi consequat metus ornare, a pellentesque odio molestie. Ut id nulla at magna pellentesque commodo. Sed quis lacus lacus. Phasellus rhoncus, leo in elementum vehicula, lorem nulla porttitor nunc, non lobortis diam sem et urna. Etiam mauris dolor, bibendum et sapien et, semper eleifend lorem. Integer orci nisi, semper ut tempor sed, gravida eget augue. Curabitur egestas massa ac arcu congue fermentum. Nulla ut euismod ipsum. Nam sollicitudin tempor leo.Maecenas eget varius lorem, eu sodales nisi. Nulla lacinia porta pharetra. Ut tincidunt orci erat, efficitur aliquet erat ultricies nec. Ut sit amet quam ut urna commodo posuere. Aenean ac massa eget justo placerat vehicula nec vel mi. Nulla accumsan pharetra mi, eget vulputate risus pharetra varius. Fusce facilisis sit amet nunc vel facilisis.Nullam a elit tincidunt, blandit orci eu, mollis felis. Vestibulum sed leo et dolor volutpat dignissim id nec neque. In at sapien nisl. Duis sagittis lorem eget odio elementum, in vehicula urna pulvinar. Proin ornare aliquam tortor vel euismod. Nam facilisis lectus sed nisi feugiat sodales. Curabitur dignissim tortor in neque viverra, id faucibus sem consequat. Duis in leo lobortis, posuere elit sed, tempus orci. Etiam libero ligula, tempus hendrerit vehicula id, gravida faucibus metus. Nunc lacinia orci ac lectus tristique commodo. Suspendisse elementum egestas leo, ac venenatis magna accumsan ac. Nulla dictum libero erat. Praesent porttitor nulla eros, efficitur scelerisque ante ullamcorper interdum. In blandit orci nulla, ac ultricies quam pharetra nec.Donec ut lacinia dui. Vestibulum suscipit pharetra ex. Duis id ornare diam. Aliquam tristique nunc malesuada, luctus lorem et, semper leo. Nam sagittis ligula diam, ut cursus sapien convallis id. Ut id nulla at magna pellentesque commodo. Sed quis lacus lacus. Phasellus rhoncus, leo in elementum vehicula, lorem nulla porttitor nunc, non lobortis diam sem et urna. Etiam mauris dolor, bibendum et sapien et, semper eleifend lorem. Integer orci nisi, semper ut tempor sed, gravida eget augue. Curabitur egestas massa ac arcu congue fermentum. Nulla ut euismod ipsum. Nam sollicitudin tempor leo.Maecenas eget varius lorem, eu sodales nisi. Nulla lacinia porta pharetra. Ut tincidunt orci erat, efficitur aliquet erat ultricies nec. Ut sit amet quam ut urna commodo posuere. Aenean ac massa eget justo placerat vehicula nec vel mi. Nulla accumsan pharetra mi, eget vulputate risus pharetra varius. Fusce facilisis sit amet nunc vel facilisis.Nullam a elit tincidunt, blandit orci eu, mollis felis. Vestibulum sed leo et dolor volutpat dignissim id nec neque. In at sapien nisl. Duis sagittis lorem eget odio elementum, in vehicula urna pulvinar. Proin ornare aliquam tortor vel euismod. Nam facilisis lectus sed nisi feugiat sodales. Curabitur dignissim tortor in neque viverra, id faucibus sem consequat. Duis in leo lobortis, posuere elit sed, tempus orci. Etiam libero ligula, tempus hendrerit vehicula id, gravida faucibus metus. Nunc lacinia orci ac lectus tristique commodo. Suspendisse elementum egestas leo, ac venenatis magna accumsan ac. Nulla dictum libero erat. Praesent porttitor nulla eros, efficitur scelerisque ante ullamcorper interdum. In blandit orci nulla, ac ultricies quam pharetra nec.Donec ut lacinia dui. Vestibulum suscipit pharetra ex. Duis id ornare diam. Aliquam tristique nunc malesuada, luctus lorem et, semper leo. Nam sagittis ligula diam, ut cursus sapien convallis id. Ut id nulla at magna pellentesque commodo. Sed quis lacus lacus. Phasellus rhoncus, leo in elementum vehicula, lorem nulla porttitor nunc, non lobortis diam sem et urna. Etiam mauris dolor, bibendum et sapien et, semper eleifend lorem. Integer orci nisi, semper ut tempor sed, gravida eget augue. Curabitur egestas massa ac arcu congue fermentum. Nulla ut euismod ipsum. Nam sollicitudin tempor leo.Maecenas eget varius lorem, eu sodales nisi. Nulla lacinia porta pharetra. Ut tincidunt orci erat, efficitur aliquet erat ultricies nec. Ut sit amet quam ut urna commodo posuere. Aenean ac massa eget justo placerat vehicula nec vel mi. Nulla accumsan pharetra mi, eget vulputate risus pharetra varius. Fusce facilisis sit amet nunc vel facilisis.Nullam a elit tincidunt, blandit orci eu, mollis felis. Vestibulum sed leo et dolor volutpat dignissim id nec neque. In at sapien nisl. Duis sagittis lorem eget odio elementum, in vehicula urna pulvinar.";
                var count = 0;
                while (!cancellationToken.IsCancellationRequested)
                {
                    
                    Thread childThread = new Thread(async () => await Send(producer, data, cancellationToken));
                    childThread.Start();
                    count++;
                    Console.WriteLine("Count: " + count);
                }
                Console.WriteLine("Start: " + start);
                Console.WriteLine("Count: " + count);
                var end = DateTime.UtcNow.ToLongTimeString();
                Console.WriteLine("End: " + end);
            }
            catch (OperationCanceledException) // If not using the cancellationToken, then just dispose the producer and catch ObjectDisposedException instead
            { }
        }

        public static async Task Send(IProducer<string> producer, string data, CancellationToken cancellationToken) {
            var msgId = await producer.Send(data, cancellationToken); 
            Console.WriteLine(msgId.ToString());

        }

        private static void Monitor(ProducerStateChanged stateChanged, CancellationToken cancellationToken)
        {
            var stateMessage = stateChanged.ProducerState switch
            {
                ProducerState.Connected => "is connected",
                ProducerState.Disconnected => "is disconnected",
                ProducerState.PartiallyConnected => "is partially connected",
                ProducerState.Closed => "has closed",
                ProducerState.Faulted => "has faulted",
                _ => $"has an unknown state '{stateChanged.ProducerState}'"
            };

            var topic = stateChanged.Producer.Topic;
            Console.WriteLine($"The producer for topic '{topic}' " + stateMessage);
        }
    }
}